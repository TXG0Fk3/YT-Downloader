<?xml version="1.0" encoding="utf-8" ?>
<ContentDialog
    x:Class="YT_Downloader.Views.Dialogs.DetailsDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:YT_Downloader.Helpers.UI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="using:YT_Downloader.Views.Dialogs"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    Title="Add New Download"
    CloseButtonText="Cancel"
    DefaultButton="Primary"
    IsPrimaryButtonEnabled="{Binding IsDownloadEnabled}"
    PrimaryButtonCommand="{Binding DownloadCommand}"
    PrimaryButtonText="Download"
    Style="{StaticResource DefaultContentDialogStyle}"
    mc:Ignorable="d">

    <ContentDialog.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        <converters:BooleanNegationConverter x:Key="BooleanNegationConverter" />
    </ContentDialog.Resources>

    <Grid
        Width="324"
        RowDefinitions="Auto, Auto, Auto"
        RowSpacing="12">
        <Grid.ChildrenTransitions>
            <TransitionCollection>
                <RepositionThemeTransition />
            </TransitionCollection>
        </Grid.ChildrenTransitions>

        <!--  URL Section  -->
        <Grid Grid.Row="0" ColumnDefinitions="*, 40">
            <TextBox
                Grid.Column="0"
                Height="62"
                Header="Enter your YT video/playlist URL:"
                KeyDown="UrlTextBox_KeyDown"
                Text="{Binding UrlBoxText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <Button
                Grid.Column="1"
                Width="35"
                Height="35"
                Padding="0"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Command="{Binding LoadContentInfoCommand}"
                ToolTipService.ToolTip="Load Video">
                <FontIcon Glyph="&#xED0E;" />
            </Button>
        </Grid>

        <!--  Video Info and Download Preferences  -->
        <Grid
            Grid.Row="1"
            RowDefinitions="Auto, Auto, Auto, Auto"
            RowSpacing="8"
            Visibility="{Binding IsContentVisible, Converter={StaticResource BooleanToVisibilityConverter}}">

            <HyperlinkButton
                Grid.Row="0"
                Padding="4"
                HorizontalAlignment="Center"
                Content="{Binding Title}"
                NavigateUri="{Binding ContentUrl}"
                ToolTipService.ToolTip="Open Video in Browser" />

            <Grid
                Grid.Row="1"
                ColumnDefinitions="*, 104"
                ColumnSpacing="6">
                <Grid
                    Grid.Column="0"
                    Background="{ThemeResource AcrylicBackgroundFillColorBaseBrush}"
                    CornerRadius="6">
                    <Image
                        Source="{Binding ThumbnailUrl}"
                        Stretch="Fill"
                        Visibility="{Binding IsContentLoading, Converter={StaticResource BooleanToVisibilityConverter}, ConverterParameter=Invert}" />
                    <ProgressRing
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Visibility="{Binding IsContentLoading}" />
                    <FontIcon
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        FontSize="32"
                        Glyph="&#xE733;"
                        Visibility="{Binding IsPlaylist, Converter={StaticResource BooleanToVisibilityConverter}}" />
                </Grid>

                <Grid
                    Grid.Column="1"
                    RowDefinitions="Auto, Auto"
                    RowSpacing="6">
                    <ComboBox
                        Grid.Row="0"
                        HorizontalAlignment="Stretch"
                        Header="Format"
                        IsEnabled="{Binding IsContentLoading, Converter={StaticResource BooleanNegationConverter}}"
                        ItemsSource="{Binding AvailableFormats}"
                        SelectedItem="{Binding SelectedFormat, Mode=TwoWay}" />
                    <ComboBox
                        Grid.Row="1"
                        HorizontalAlignment="Stretch"
                        Header="Quality"
                        IsEnabled="{Binding IsQualitySelectionEnabled}"
                        ItemsSource="{Binding AvailableQualities}"
                        SelectedValue="{Binding SelectedQuality, Mode=TwoWay}" />
                </Grid>
            </Grid>

            <TextBox
                Grid.Row="2"
                Grid.Column="0"
                Height="62"
                Header="File Name:"
                IsEnabled="{Binding IsFileNameBoxEnabled}"
                PlaceholderText="{Binding DefaultFileName}"
                Text="{Binding UserFileName, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />

            <TextBlock Grid.Row="3">
                <Run>File Size:</Run>
                <LineBreak />
                <Run Foreground="DarkGray" Text="{Binding SizeMB}" />
            </TextBlock>
        </Grid>

        <!--  Error&Warnings InfoBar  -->
        <InfoBar
            Title="Error"
            Grid.Row="2"
            IsClosable="false"
            IsOpen="True"
            Message="{Binding ErrorMessage}"
            Severity="Error"
            Visibility="{Binding IsErrorVisible, Converter={StaticResource BooleanToVisibilityConverter}}" />
    </Grid>
</ContentDialog>
